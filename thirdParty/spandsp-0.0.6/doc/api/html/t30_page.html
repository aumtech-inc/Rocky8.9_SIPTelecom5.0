<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>spandsp: T.30 FAX protocol handling</title>
<link href="css.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<h1><a class="anchor" name="t30_page">T.30 FAX protocol handling</a></h1><h2><a class="anchor" name="t30_page_sec_1">
What does it do?</a></h2>
The T.30 protocol is the core protocol used for FAX transmission. This module implements most of its key featrues. It does not interface to the outside work. Seperate modules do that for T.38, analogue line, and other forms of FAX communication.<p>
Current features of this module include:<p>
<ul>
<li>FAXing to and from multi-page TIFF/F files, whose images are one of the standard FAX sizes.</li><li>V.27ter, V.29 and V.17 modes (2400bps, to 14,400bps).</li><li>T.4 1D (MH), T.4 2D,(MR) and T.6 (MMR) compression.</li><li>Error correction mode (ECM).</li><li>All standard horizonal resolutions (R8, R16, 300dpi, 600dpi, 800dpi, 1200dpi).</li><li>All standard vertical resolutions (standard, fine, superfine, 300dpi, 600dpi, 800dpi, 1200dpi).</li><li>All standard page widths (A4, B4, A3).</li><li>All standard page lengths (A4, B4, North American letter, North American legal, continuous).</li><li>Monitoring and sending identifier strings (CSI, TSI, and CIG).</li><li>Monitoring and sending sub-address strings (SUB).</li><li>Monitoring and sending polling sub-addresses (SEP).</li><li>Monitoring and sending polled sub-addresses (PSA).</li><li>Monitoring and sending sender identifications (SID).</li><li>Monitoring and sending passwords (PWD).</li><li>Monitoring of non-standard facility frames (NSF, NSC, and NSS).</li><li>Sending custom non-standard facility frames (NSF, NSC, and NSS).</li><li>Analogue modem and T.38 operation.</li></ul>
<h2><a class="anchor" name="t30_page_sec_2">
How does it work?</a></h2>
Some of the following is paraphrased from some notes found a while ago on the Internet. I cannot remember exactly where they came from, but they are useful.<h3><a class="anchor" name="t30_page_sec_2a">
The answer (CED) tone</a></h3>
The T.30 standard says an answering fax device must send CED (a 2100Hz tone) for approximately 3 seconds before sending the first handshake message. Some machines send an 1100Hz or 1850Hz tone, and some send no tone at all. In fact, this answer tone is so unpredictable, it cannot really be used. It should, however, always be generated according to the specification.<h3><a class="anchor" name="t30_page_sec_2b">
Common Timing Deviations</a></h3>
The T.30 spec. specifies a number of time-outs. For example, after dialing a number, a calling fax system should listen for a response for 35 seconds before giving up. These time-out periods are as follows:<p>
<ul>
<li>T1 - 35+-5s: the maximum time for which two fax system will attempt to identify each other</li><li>T2 - 6+-1s: a time-out used to start the sequence for changing transmit parameters</li><li>T3 - 10+-5s: a time-out used in handling operator interrupts</li><li>T5 - 60+-5s: a time-out used in error correction mode</li></ul>
<p>
These time-outs are sometimes misinterpreted. In addition, they are routinely ignored, sometimes with good reason. For example, after placing a call, the calling fax system is supposed to wait for 35 seconds before giving up. If the answering unit does not answer on the first ring or if a voice answering machine is connected to the line, or if there are many delays through the network, the delay before answer can be much longer than 35 seconds.<p>
Fax units that support error correction mode (ECM) can respond to a post-image handshake message with a receiver not ready (RNR) message. The calling unit then queries the receiving fax unit with a receiver ready (RR) message. If the answering unit is still busy (printing for example), it will repeat the RNR message. According to the T.30 standard, this sequence (RR/RNR RR/RNR) can be repeated for up to the end of T5 (60+-5s). However, many fax systems ignore the time-out and will continue the sequence indefinitely, unless the user manually overrides.<p>
All the time-outs are subject to alteration, and sometimes misuse. Good T.30 implementations must do the right thing, and tolerate others doing the wrong thing.<h3><a class="anchor" name="t30_page_sec_2c">
Variations in the inter-carrier gap</a></h3>
T.30 specifies 75+-20ms of silence between signals using different modulation schemes. Examples are between the end of a DCS signal and the start of a TCF signal, and between the end of an image and the start of a post-image signal. Many fax systems violate this requirement, especially for the silent period between DCS and TCF. This may be stretched to well over 100ms. If this period is too long, it can interfere with handshake signal error recovery, should a packet be corrupted on the line. Systems should ensure they stay within the prescribed T.30 limits, and be tolerant of others being out of spec..<h3><a class="anchor" name="t30_page_sec_2d">
Other timing variations</a></h3>
Testing is required to determine the ability of a fax system to handle variations in the duration of pauses between unacknowledged handshake message repetitions, and also in the pauses between the receipt of a handshake command and the start of a response to that command. In order to reduce the total transmission time, many fax systems start sending a response message before the end of the command has been received.<h3><a class="anchor" name="t30_page_sec_2e">
Other deviations from the T.30 standard</a></h3>
There are many other commonly encountered variations between machines, including:<p>
<ul>
<li>frame sequence deviations</li><li>preamble and flag sequence variations</li><li>improper EOM usage</li><li>unusual data rate fallback sequences</li><li>common training pattern detection algorithms</li><li>image transmission deviations</li><li>use of the talker echo protect tone</li><li>image padding and short lines</li><li>RTP/RTN handshake message usage</li><li>long duration lines</li><li>nonstandard disconnect sequences</li><li>DCN usage </li></ul>
<hr size="1"><address style="align: right;"><small>Generated on Wed Mar 17 10:16:38 2010 for spandsp by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
